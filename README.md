# matvik22000.github.io
дока по чату:
работа с сервером для чата.

1)открываешь 2 вебсокета по адресам:
	1)wss://warm-bayou-37022.herokuapp.com/receive  (сюда будут приходить сообщения)
	2)wss://warm-bayou-37022.herokuapp.com/submit (сюда ты шлешь сообщения)
2) в первый сокет ты шлешь JSON такого формата:
	{"key":"10","msg":"true","name":"name","token":"RA2SD3GDOSZ5Q0F"}
  1. key: "10" уникальный ключ(id) пользователя
  1. msg: "true": нужно ли добавлять тебя в список подключенных прользователей. true - да, false - нет(нужно для подгрузки сообщений)
  3. name: "name" твой ник
  4. token: этот параметр надо отправлять со всеми сообщения(вообще сл любым сообщением, которое ты шлёшь на сервер). Про то где его взять расскажу позже
о событиях, происходящих в чате тебя информируют такие сообщения:
{"system": "true", "name": "name", "key":"10", "event": "reg"}
1. event: "reg" бывает reg(значит что зашел новый пользователь) или close(значит что пользователь отключился), kick(пользователя отключили), map(расскажу позже)
2. key: "10" уникальный ключ(id) пользователя
3. name: "name" ник, так этого юзера должны видеть остальные
4. system: "true" true – сообщение системное, его не надо отображать. Бывает false, значит 
сообщение надо отображать

	такие сообщения приходят всем пользователям которые в сети на данный момент. Это позволяет 	отображать находится	ли определенный пользователь в сети в данный момент
3)сообщения которые приходят тебе и которые ты шлешь делятся на 
	-общие
	-личные
  -системные
	(общие видны всем, личные только адресату.)
	И на 
	-текст
	-картинки
	рассмотрим все возможные варианты сообщений:
	1)общее текст
	{"system":false,"uuid":"170.51287793191963","text":"1","name":"спамер","icon":"3",
	"time":"October 26th 2018, 3:58:49 pm","type":"text"}

1. icon: "3" бывает 3 значения, обозначает иконку которая должна отображаться рядом с пользователем
1)  
2) 
3) 
2. name: "спамер" ник отправившего сообщение юзера
3. system: false значит что сообщение системное и его надо отображать
4. text: "1" текст сообщения
5. time: "October 26th 2018, 3:58:49 pm" время отправки сообщения
6. type: "text" тип сообщения, бывает 2 видов:
1)text: тестовое
2)img: картинка
7. uuid: "170.51287793191963" ключ(id) отправителя
2) общее картинка
Всё также как и в первом случае, но тип не text, а img, а в text не текст сообщения, а ссылка на картинку.
{"system":false,"uuid":"170.51287793191963","text":"https://bipbap.ru/wp-content/uploads/2017/04/leto_derevo_nebo_peyzazh_dom_derevya_domik_priroda_3000x2000.jpg","name":"спамер","icon":"3","time":"October 26th 2018, 3:40:40 pm","type":"img"}

1.icon: "3"
2.name: "спамер"
2.system: false
3.text: "https://bipbap.ru/wp- content/uploads/2017/04/leto_derevo_nebo_peyzazh_dom_derevya_domik_priroda_3000x2000.jpg"
5.time: "October 26th 2018, 3:40:40 pm"
6.type: "img"
7.uuid: "170.51287793191963"

	3) личное текст 
	{"system":false,"uuid":"170.51287793191963","text":"1","name":"спамер","icon":"3",
	"time":"October 26th 2018, 3:58:35 pm","address":"50.97423463710501","nameAddress":"name","type":"text"}
1. address: "50.97423463710501" id адресата сообщения, сообщение должно отобразиться только если твой ключ совпадает с ключом адресата(снова очень тупо, но просто)
2. icon: "3" номер иконки(как в 1 случае)
3. name: "спамер" ник отправителя
4. nameAddress: "name" ник адресата
5. system: false 
6. text: "1" тектс сообщения
7. time: "October 26th 2018, 3:58:35 pm" 
8. type: "text" тип сообщения (тот который text или img)
9. uuid: "170.51287793191963" id отправителя
	

	4) личное картинка
	как и в 3 случае, но тип img, а вместо текста — ссылка
	{"system":false,"uuid":"170.51287793191963",
	"text":"https://vk.com/images/stickers/3/128.png",
	"name":"спамер","icon":"3","time":"October 26th 2018, 4:53:00 pm”,	"address":"50.97423463710501","nameAddress":"name","type":"img"}

1. address: "50.97423463710501"
2. icon: "3"
3. name: "спамер"
4. nameAddress: "name"
5. system: false
6. text: "https://vk.com/images/stickers/3/128.png"
7. time: "October 26th 2018, 4:53:00 pm"
8. type: "img" 
9. uuid: "170.51287793191963"
когда ты подключаешься к серверу тебе приходят 30 последних сообщений. Все отправленные сообщения хранятся в базе данных на сервере.
Важно что ключ должен храниться на устройстве, а не меняться при каждом новом заходе пользователя, иначе старые сообщения будут адресованы юзеру со старым ключом и не отобразятся, так как ключ поменялся и не совпадает со старым.

<b>ВАЖНО</b>
<b>когда ты шлешь любое сообщение(даже системное) ты ДОЛЖЕН прикрепить к нему токен. К тебе сообщения приходят без токена. Отправленное сообщение должно выглядеть примерно так:/b>
{
icon: "1"
name: "name"
system: "false"
text: "сообщение"
time: "January 17th 2019, 5:46:56 pm"
token: "RA2SD3GDOSZ5Q0F" - токен. Без него сообщение не дойдет до адресата, а сокет будет разорван. 
type: "text"
uuid: "10"
}
также в submit тебе приходят сообщения о токенах (Только они и приходят, все остальные сообщения приходят в recieve) они бывают:
1)"write token" : для uuid, указанного в сообщении токен верный.
  "wrong token" : для указанного uuid токен другой.
2)"token valid" : время действительности(1 час) для токена не прошло
  "token fired" : токен устарел, самое время получить новый
3)"no token found" : либо в сообщении отсутствует параметр token, либо для указанного uuid не получен токен
                              <h1>Регистрация</h1>
регистрация и авторизация проходит при помощи http запросов. На данный момент есть 2 варианта для регистрации/авторизации:
- при помощи VK API (https://vk.com/dev)
- при помощи логина и пароля

<h2> регистрация </h2>
<h3>при помощи vk</h3>
<h4><b>запрос</b></h4>
в общем виде запрос выглядит так:

``` javascript
minAjax({
        url: "https://warm-bayou-37022.herokuapp.com/reg",
        type: "GET", (POST запрос не прокатит, только GET)
        data:{
            type: "vk" - означает, что регистрация производится при помощи vk id, 
            id: *id из ответа от vk auth*,
            info: *любая информаиця о пользователе, которую удалось добыть*,
            name: *ник пользователя*
            
        },
     
    });
 ```
<h4>ответ</h4>
-success - пользователь зарегистрирован
-что-либо другое - не вышло :(
<h3>логин + пароль</h3>
<h4>запрос</h4>

``` javascript
minAjax({

        url: "https://warm-bayou-37022.herokuapp.com/reg",
        type: "GET", (POST запрос не прокатит, только GET)
        data:{
            type: "lp" - означает, что регистрация производится при помощи логина и пароля,
            login: *логин(не тот что будет виден в чате, этот не видно нигде)*,
            password: *пароль*,
            info: *любая информаиця о пользователе, которую удалось добыть*,
            name: *ник пользователя*
            
        },
     
    });
 ```
<h4>ответ</h4>
-success - пользователь зарегистрирован
-что-либо другое - не вышло :(

<h2>авторизация</h2>
<h3>при помощи vk</h3>
запрос

``` javascript
 minAjax({
           url: "https://warm-bayou-37022.herokuapp.com/login",
           type: "GET",
           data: {
               type: "vk",
               id: *uid из vk auth*
               save: true/false (надо-ли запоминать это устройство)

          },
});
```
ответ

``` javascript
["4", - id пользователя в чате
"OOBKZKN18F64VQQ", - код, который надо сохранить чтобы потом входить без авторизации(ниже опишу подробнее)
"Teststeeetrr",  - ник пользователя
"3", иконка пользователя
  [
  "9GEQ1CH91ZWEA61", 
  "1547738823077"
  ]
]
```
-что-либо другое - не вышло :(


Ссылка на мою реализацию клиента
gurhouse.ru/kk



	


